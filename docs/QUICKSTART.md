# MedCrux 快速启动指南

> **版本**：v1.2.0  
> **更新日期**：2026-01-04

---

## 🚀 快速启动（3步）

### 步骤1：设置API密钥

```bash
export DEEPSEEK_API_KEY="sk-your-api-key-here"
```

**注意**：如果没有API密钥，OCR功能仍可用，但AI分析功能将不可用。

---

### 步骤2：启动后端服务

在**终端1**中运行：

```bash
./scripts/start_api.sh
```

**预期输出**：
```
🚀 启动MedCrux API服务（使用uv）...
✅ 使用uv运行服务...
INFO:     Uvicorn running on http://127.0.0.1:8000
```

**验证**：打开浏览器访问 `http://127.0.0.1:8000/health`，应该看到：
```json
{"status":"operational","version":"1.2.0"}
```

---

### 步骤3：启动前端界面

在**终端2**中运行：

```bash
./scripts/start_ui.sh
```

**预期输出**：
```
🌐 启动MedCrux UI界面（使用uv）...
✅ 使用uv运行UI服务...
You can now view your Streamlit app in your browser.
Local URL: http://localhost:8501
```

**验证**：浏览器会自动打开，或手动访问 `http://localhost:8501`

---

## ✅ 验证产品可用性

### 1. 健康检查

访问 `http://127.0.0.1:8000/health`，应该返回：
```json
{"status":"operational","version":"1.2.0"}
```

### 2. UI界面检查

打开 `http://localhost:8501`，应该看到：
- ✅ 页面标题：MedCrux Analysis v1.2.0
- ✅ 免责声明和数据隐私说明
- ✅ 文件上传区域
- ✅ "开始分析"按钮（绿色，大按钮）

### 3. 功能测试

1. **上传测试图片**：上传一张乳腺超声报告图片（JPG/PNG格式）
2. **查看原始图像**：应该能看到上传的图片（顶部，左侧1/2宽度）
3. **点击"开始分析"**：
   - 按钮应该显示加载状态
   - 分析完成后，按钮变为"分析完成 ✅"
   - 应该能看到分析结果

---

## 🔧 常见问题

### 问题1：uv未安装

**错误信息**：
```
❌ 错误: uv未安装
```

**解决方法**：
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

### 问题2：端口被占用

**错误信息**：
```
ERROR:    [Errno 48] Address already in use
```

**解决方法**：
- 检查是否有其他服务占用8000或8501端口
- 或者修改启动脚本中的端口号

### 问题3：API服务无法连接

**错误信息**：
```
🔴 无法连接后端 (请检查 FastAPI 是否启动)
```

**解决方法**：
1. 确认后端服务已启动（终端1）
2. 访问 `http://127.0.0.1:8000/health` 验证
3. 检查防火墙设置

### 问题4：DEEPSEEK_API_KEY未设置

**警告信息**：
```
⚠️  警告: DEEPSEEK_API_KEY未设置，AI分析功能将不可用
```

**解决方法**：
```bash
export DEEPSEEK_API_KEY="sk-your-api-key-here"
```

**注意**：即使没有API密钥，OCR功能仍可用，可以测试OCR识别。

---

## 📝 使用说明

### 基本流程

1. **上传报告**：点击"选择文件"按钮，选择乳腺超声报告图片
2. **查看原始图像**：上传后，原始图像显示在顶部左侧
3. **查看OCR原文**（可选）：点击右侧的expander，可以查看OCR识别的原文
4. **开始分析**：点击绿色的"开始分析 🚀"按钮
5. **查看结果**：
   - **结节列表**：左侧显示所有识别的结节（圆弧边按钮）
   - **胸部示意图**：右侧显示乳腺示意图，标注结节位置
   - **结节详情**：底部左侧显示选中结节的详细信息
   - **整体评估**：底部右侧显示整体评估、事实摘要和建议

### 交互说明

- **选择结节**：点击结节列表中的按钮，或点击示意图中的结节标记
- **查看详情**：选中结节后，详情卡片自动更新
- **风险等级**：
  - 🟢 低风险（Low）
  - 🟡 中风险（Medium）
  - 🔴 高风险（High）

---

## 🎯 产品功能清单

### ✅ 已实现功能（v1.2.0）

- [x] OCR文字识别（RapidOCR）
- [x] RAG检索（GraphRAG知识图谱）
- [x] LLM智能分析（DeepSeek）
- [x] BI-RADS一致性检查
- [x] 风险评估（Low/Medium/High）
- [x] 多结节识别和分离
- [x] 结节列表和示意图
- [x] 结节详情卡片
- [x] 整体评估卡片
- [x] UI布局优化（1:1比例）
- [x] 原始图像自适应
- [x] OCR原文默认关闭
- [x] 分析按钮优化
- [x] 结节列表圆弧边按钮
- [x] 示意图优化（移除象限标注）

---

## 📞 技术支持

如遇到问题，请检查：
1. 所有依赖是否已安装（`uv sync`）
2. API服务是否正常运行
3. 环境变量是否设置正确
4. 查看终端错误信息

---

**版本**：v1.2.0  
**最后更新**：2026-01-04
